<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-type" content="text/html; charset=utf-8">
	<title>backchan.nl &mdash; thin</title>

	<script src="/static/js/jquery-1.6.2.min.js" type="text/javascript"></script>
	<script src="/socket.io/socket.io.js"></script>
	
	<script type="text/javascript" charset="utf-8">
		var socket = io.connect("http://<% server %>:<%= port %>");
	
		$(document).ready(function() {
			console.log("Document is ready!");

			if("name" in localStorage && "affiliation" in localStorage) {
				socket.emit("identify", {
					"name":localStorage["name"],
					"affiliation":localStorage["affiliation"]});
				$("#identify").hide();
			} else {
				$("#dashboard").hide();
			}

			
			
			$("#identify form").submit(function(event) {
				// Send a message to the server.
				
				var name = $("#name").val();
				var affiliation = $("#affiliation").val();
				
				socket.emit("identify", {
					"name":name,
					"affiliation":affiliation});
					
					localStorage["name"] = name;
					localStorage["affiliation"] = affiliation;
					
				event.preventDefault();
			});
			
			$("#toggle-post").click(function() {
				
				// Decide what our current state is.
				var postContainerEl = $("#post-container");

				if(parseInt(postContainerEl.css("top")) < 0) {
					// Animate to expose it.
					postContainerEl.animate({top:0});
				} else {
					// Animate to hide it.
					postContainerEl.animate({top:-131});
				}
			});
			
		});
		
		socket.on('connect', function(data) {
			console.log("Connected to server.");
		});
		
		socket.on('identify', function(data) {
			$("#identity").text(data["name"] + " / " + data["affiliation"]);
			$("#presence").text("1 person connected");
			
			
			// When the server ACKS our identify operation, hide that pane
			// and show the main one.
			$("#identify").hide();
			$("#dashboard").show();
			
		});
		
	</script>
	
	<style type="text/css" media="screen">
		body {
			font-family: Helvetica, sans-serif;
			margin: 0px;
		}
		
		#container {
			margin-left: auto;
			margin-right: auto;
			border: 1px solid black;
			
			width: 1002px;
			height: 150px;
		}
		
		#identify {
			margin-left: auto;
			margin-right: auto;
			width: 300px;
		}
		
		#identify h1 {
			font-size: 1.5em;
		}
		
		#identify table tr:first-child {
			text-align: right;
		}
		
		#identify input[type="text"] {
			width: 175px;
		}
		
		#dashboard {
			width: 100%;
			height: 100%;
		}
		
		#hot, #new {
			float: left;
			height: 130px;
		}
		
		#dashboard > div h1 {
			background-color: black;
			color: white;
			width: 65px;
			text-align: center;
			
			margin-top: 0px;
		}
		
		#hot {
			width: 500px;
			border-right: 1px solid #ccc;
		}
		
		#hot h1 {
			float: left;
		}
		
		#new {
			width: 501px;
		}
		
		#new h1 {
			float: right;
		}
		
		#footer {
			background-color: black;
			text-align: center;
			color: white;
			height: 20px;
			
			font-size: 0.8em;
		}
		
		#identity, #presence {
			padding: 4px;
		}
		
		#identity {
			float: left;
			text-align: left;
		}
		
		#presence {
			float: right;
			text-align: right;
		}
		
		#show-posts {
			position: absolute;
			left: 50%;
			
			width: 150px;
			margin-left: -75px;
			
			font-size: 1.3em;
		}
		
		
		#post-container {
			position: absolute;
			top: -131px;
			left: 50%;
			
			margin-left: -250px;
			width: 500px;
			
			z-index: 2;
		}
		
		#post {
			background-color: white;
			border: 1px solid black;
			
			height: 130px;
		}
		
		#toggle-post {
			position: relative;
			top: 0px;
			left: 50%;
			
			height: 20px;
			
			width: 150px;
			margin-left: -75px;
			
			text-align: center;
			
			border: 1px solid black;
			border-top: none;
			background-color: #ddd;
			
			z-index: 2;
		}
		
		#post-text {
			
		}
		
		
		
		
		.clickable {
			cursor: pointer;
		}
		
		.clear {
			clear: both;
		}
		
	</style>
</head>
<body id="index" onload="">
<div id="container">

<div id="identify">
	<h1>Welcome to backchan.nl!</h1>
	<form method="get" accept-charset="utf-8">
	<table border="0">
		<tr><td>Name</td><td><input type="text" name="name" value="" id="name"></tr>
		<tr><td>Affiliation</td><td><input type="text" name="affiliation" value="" id="affiliation"></td></tr>
		<tr><td></td><td><input type="submit" name="set_identity" value="login" id="set_identity"<></td></tr>
	</table>
	</form>
</div>


<div id="dashboard">
<div id="hot">
<h1>hot</h1>
</div>

<div id="new">
<h1>new</h1>


</div>

<br class="clear">

<div id="footer">
<div id="identity">
</div>

<div id="show-posts" class="clickable">
show all posts
</div>

<div id="presence">
</div>
</div>
<br class="clear">
</div>


</div>

<div id="post-container">
<div id="post">
	<h1>Submit a post</h1>
	<textarea id="post-text">
	</textarea>
	<input type="button" name="post" value="post" id="submit-post">
</div>
<div id="toggle-post" class="clickable">
post a thought
</div>
</div>


</body>
</html>